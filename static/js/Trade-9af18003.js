import{_ as B,d as V,o as d,c as p,F as X,g as re,n as ke,t as u,b as o,m as T,i as Z,j as A,e as k,u as l,q as O,s as Q,v as ve,x as R,w as H,y as J,p as ye,k as Se,z as Ie,A as Ce,B as le,C as M,D as I,E as ie,G as C,H as Te,I as q,J as $e,M as De,K as Le,L as Be}from"./index-14124742.js";import{C as Ve}from"./ColorsBorderBox-4cb7e4bf.js";import{g as Oe,r as Ae,e as W,S as ue}from"./SwapItem-4bafbb58.js";import{C as de}from"./ColorsButton-c78e20ee.js";const Pe={class:"flex-center-bw lg:flex-col lg:gap-y-10 text-base rounded-xl border-2 border-solid border-[#1dede1] p-2.5"},Fe=["onClick"],Ue=V({props:{tabList:{type:Array,required:!0},currentTab:{type:Number,required:!0}},emits:["change"],setup(s,{emit:w}){return(b,c)=>(d(),p("div",Pe,[(d(!0),p(X,null,re(s.tabList,r=>(d(),p("div",{key:r.id,class:ke(["cursor-pointer font-semibold rounded-lg py-1 px-2 lg:w-full text-center lg:min-w-[100px]",{"bg-[#1dede1]":r.id===s.currentTab,"text-origin":r.id===s.currentTab,"text-[#46598B]":r.disabled}]),onClick:_=>w("change",r)},u(r.name),11,Fe))),128))]))}}),Ee=B(Ue,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/components/TradeTab.vue"]]),Ne=""+new URL("../images/exchange-3a08e937.svg",import.meta.url).href,qe=""+new URL("../images/setting-66f9da98.svg",import.meta.url).href,Re={class:"flex-center-bw mb-[38px]"},He=o("div",{class:"text-[32px] font-bold"},"Swap",-1),Me=o("img",{src:qe,class:"w-7",alt:""},null,-1),Ke=[Me],je=V({emits:["open"],setup(s,{emit:w}){return(b,c)=>(d(),p("div",Re,[He,o("div",{onClick:c[0]||(c[0]=r=>w("open"))},Ke)]))}}),ze=B(je,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/swap/SwapHeader.vue"]]),Ge={class:"border border-main border-solid rounded-lg p-2.5 px-3 mt-5"},Je=A(" 1 "),We={class:"text-main"},Ze={class:"text-main"},Qe={key:0,class:"mt-1.5"},Xe={class:"flex-center-bw mt-1.5"},Ye={class:"text-main"},et={class:"flex-center-bw mt-1.5"},tt={class:"text-main"},at={key:0},nt={key:1},st={class:"flex-center-bw mt-1.5"},ot={class:"text-main"},lt={key:0},it={else:""},ut={key:0},dt={key:1},rt={class:"flex-center-bw mt-1.5"},ct={class:"text-main"},mt=o("span",{class:"text-main"},null,-1),pt=V({props:{tokenA:{type:null,required:!0},tokenB:{type:null,required:!0},swapDetail:{type:null,required:!0},isOut:{type:Boolean,required:!1}},setup(s){const w=T({open:!1}),b=()=>{w.open=!w.open};return(c,r)=>{const _=Z("van-icon");return d(),p("div",Ge,[o("div",{class:"flex-center-bw cursor-pointer",onClick:b},[o("div",null,[Je,o("span",We,u(s.tokenA.symbol),1),A(" = "+u(s.swapDetail.aToBPrice)+" ",1),o("span",Ze,u(s.tokenB.symbol),1)]),k(_,{name:"arrow-down",alt:"",class:"w-2.5 h-auto text-main"})]),l(w).open?(d(),p("div",Qe,[o("div",Xe,[o("div",Ye,u(c.$t("trade.swapDetail.networkFee")),1),o("div",null," ~"+u(s.swapDetail.networkFee),1)]),o("div",et,[o("div",tt,u(c.$t("trade.swapDetail.priceImpact")),1),o("div",null,[s.swapDetail.priceImpact<.01?(d(),p("span",at," <0.01% ")):(d(),p("span",nt,"~"+u(l(O)(s.swapDetail.priceImpact,2))+"%",1))])]),o("div",st,[o("div",ot,[s.isOut?(d(),p("span",lt,u(c.$t("trade.swapDetail.minOutput")),1)):Q("v-if",!0),o("span",it,u(c.$t("trade.swapDetail.maximumSold")),1)]),o("div",null,[s.isOut?(d(),p("span",ut,u(s.swapDetail.minimumOutput?s.swapDetail.minimumOutput.toFixed():"0")+" "+u(s.tokenB.symbol),1)):(d(),p("span",dt,u(s.swapDetail.maximumSold?s.swapDetail.maximumSold.toFixed():"0")+" "+u(s.tokenA.symbol),1))])]),o("div",rt,[o("div",ct,[A(u(c.$t("trade.swapDetail.expectOutput")),1),mt]),o("div",null,u(s.swapDetail.expectedOutput?s.swapDetail.expectedOutput.toFixed():"0")+" "+u(s.tokenB.symbol),1)])])):Q("v-if",!0)])}}}),wt=B(pt,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/swap/SwapDetail.vue"]]),bt=()=>{const s=Oe();return{getPair:async(b,c)=>{try{return await s.getPair(b,c)}catch(r){return ve(r)}}}};const Y=s=>(ye("data-v-27a4fc01"),s=s(),Se(),s),ft={class:"bg-[#081e37] px-4 py-7 w-[320px]"},gt=Y(()=>o("div",null,"Max slippage",-1)),xt={class:"grid grid-cols-4 gap-x-2 mt-4 pb-6 text-main border-b border-solid border-main"},_t=["onClick"],ht={class:"flex-center"},kt=A(" % "),vt={class:"flex-center-bw gap-5 mt-4"},yt=Y(()=>o("div",{class:"whitespace-nowrap"},"Transaction deadline",-1)),St={class:"flex-center text-main gap-1"},It=Y(()=>o("div",null,"min",-1)),Ct=V({props:{show:{type:Boolean,required:!0},slipValue:{type:[String,Number,null],required:!0},timeValue:{type:[String,Number,null],required:!0}},emits:["close","update:slip-value","update:time-value"],setup(s,{emit:w}){const{show:b,slipValue:c}=s,r=[.1,.5,1],_=$=>{w("update:slip-value",$)},v=$=>{w("update:time-value",$)};return($,f)=>{const P=Z("VanField"),K=Z("VanPopup");return d(),R(K,{show:s.show,"onUpdate:show":f[2]||(f[2]=g=>J(b)?b.value=g:null),class:"bg-transparent",closeable:"",round:"",onClickOverlay:f[3]||(f[3]=g=>w("close")),onClickCloseIcon:f[4]||(f[4]=g=>w("close"))},{default:H(()=>[o("div",ft,[gt,o("div",xt,[(d(),p(X,null,re(r,g=>o("div",{class:"cursor-pointer rounded-xl bg-[#061629] flex-center",onClick:ee=>_(String(g))},u(g)+" % ",9,_t)),64)),o("div",ht,[k(P,{modelValue:s.slipValue,"onUpdate:modelValue":[f[0]||(f[0]=g=>J(c)?c.value=g:null),_],class:"flex-1 bg-[#061629] rounded-xl text-xs text-baseColor font-bold",type:"number"},null,8,["modelValue"]),kt])]),o("div",vt,[yt,o("div",St,[k(P,{modelValue:s.timeValue,"onUpdate:modelValue":[f[1]||(f[1]=g=>J(timeValue)?timeValue.value=g:null),v],class:"flex-1 bg-[#061629] rounded-xl text-xs text-baseColor font-bold",type:"number","input-align":"center"},null,8,["modelValue"]),It])])])]),_:1},8,["show"])}}}),Tt=B(Ct,[["__scopeId","data-v-27a4fc01"],["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/swap/SettingPop.vue"]]),$t={class:"lg:px-8 px-2.5 py-5"},Dt=o("img",{src:Ne,class:"w-[38px] h-[36px] mx-auto",alt:""},null,-1),Lt=[Dt],Bt={key:0},Vt={key:1},Ot={key:2},At={key:3},Pt=V({setup(s){const w=Ie(),{accountStore:b}=Ce(),{connectWallet:c}=le(),{getAmountsOut:r,getAmountsIn:_,swapTokensForExactTokens:v,swapExactTokensForTokens:$,swapExactETHForTokens:f,swapExactTokensForETH:P,swapETHForExactTokens:K,swapTokensForExactETH:g}=Ae(),{getPair:ee}=bt(),ce=M(()=>!e.havePair||+t.amount<=0||+t.amount>+t.balance),te=M(()=>+t.allowance>=+t.amount&&t.allowance>0),t=T({...I.tokens[0],balance:0,allowance:0,decimals:18,amount:null}),n=T({...I.tokens[1],balance:0,allowance:0,decimals:18,amount:null}),m=T({networkFee:0,priceImpact:0,minimumOutput:null,maximumSold:null,expectedOutput:null,aToBPrice:0,bToAPrice:0}),me=M(()=>!e.aDisabled),e=T({settingShow:!1,btnLoading:!1,havePair:!1,aDisabled:!1,bDisabled:!1,aInputLoading:!1,bInputLoading:!1,pair:null,txInfo:{tx:null,text:""}}),h=T({slip:.1,time:10,min:"0"}),pe=async()=>{e.settingShow=!e.settingShow},we=a=>{h.slip=a,!(!t.amount&&!n.amount)&&(j(t.amount),z(n.account))},be=a=>{h.time=a},fe=()=>{e.bDisabled=!0,e.aDisabled=!1},ge=()=>{e.aDisabled=!0,e.bDisabled=!1},j=async a=>{if(e.btnLoading||e.aDisabled)return e.bInputLoading=!1;if(a===""){t.amount=null,n.amount=null,m.expectedOutput=null,m.minimumOutput=null,m.maximumSold=null,m.priceImpact=null,e.bInputLoading=!1;return}t.amount=a,e.bInputLoading=!0;const i=await r(a,[t.address,n.address]);n.amount=i||"0",m.expectedOutput=new C(n.amount),m.minimumOutput=new C(n.amount).times(1e4-100*h.slip).div(1e4),m.maximumSold=new C(t.amount).times(1e4+100*h.slip).div(1e4),m.priceImpact=a/+await W(t.address).balanceOf(e.pair)*100,e.bInputLoading=!1},z=async a=>{if(e.btnLoading||e.bDisabled)return e.aInputLoading=!1;if(a===""){t.amount=null,n.amount=null,m.expectedOutput=null,m.minimumOutput=null,m.maximumSold=null,m.priceImpact=null,e.aInputLoading=!1;return}n.amount=a,e.aInputLoading=!0,t.amount=await _(a,[t.address,n.address])||0,m.expectedOutput=new C(n.amount),m.minimumOutput=new C(n.amount).times(1e4-100*h.slip).div(1e4),m.maximumSold=new C(t.amount).times(1e4+100*h.slip).div(1e4),e.aInputLoading=!1},xe=async()=>{var i;if(e.btnLoading)return;let a=T({...t,amount:(i=t.amount)==null?void 0:i.toString()});if(t.address=n.address,n.address=a.address,t.icon=n.icon,n.icon=a.icon,await ae(),e.bDisabled?(e.aInputLoading=!0,n.amount=t.amount):(e.bInputLoading=!0,t.amount=n.amount),await ne(),!t.amount&&!n.amount){e.aInputLoading=!1,e.bInputLoading=!1;return}e.bDisabled?(e.aDisabled=!0,e.bDisabled=!1,n.amount=t.amount,z(n.amount)):(e.aDisabled=!1,e.bDisabled=!0,t.amount=n.amount,j(t.amount))},G=async a=>{const{balanceOf:i,allowance:x,symbol:y,decimals:U}=W(a),D=q(a,I.BNB)?await $e():await i(),E=q(a,I.BNB)?De:await x(I.PANCAKE_ROUTER),L=await y(),N=await U();return{balance:D,allowance:+E,symbol:L,decimals:N}},_e=async()=>{const a=await ee(t.address,n.address);return e.pair=a,a!==Te},ae=async()=>{const a=await G(t.address),i=await G(n.address);t.balance=a.balance,t.allowance=a.allowance,t.symbol=a.symbol,t.decimals=a.decimals,n.balance=i.balance,n.allowance=i.allowance,n.symbol=i.symbol,n.decimals=i.decimals},ne=async()=>{if(!e.havePair)return;const a=[t.address,n.address],i=await r(1,a);m.aToBPrice=i||0;const x=await _(1,a.reverse());m.bToAPrice=x||0},F=async()=>{e.btnLoading=!0,ae(),e.havePair=await _e(),ne(),e.btnLoading=!1},se=async()=>{if(!te.value){e.btnLoading=!0;const a=await W(t.address).approve(I.PANCAKE_ROUTER);if(!a.success)return e.btnLoading=!1;if(a.success){const i=await G(t.address);t.allowance=i.allowance,se()}return}he()},he=async()=>{e.btnLoading=!0;const a=le().getCurrentAccount(),i=h.time,x=[t.address,n.address];let y=null,U=0,D=null,E=0,L=null;const N=q(t.address,I.BNB),oe=q(n.address,I.BNB);if(e.bDisabled){const S=O(t.amount,t.decimals).toString();E=await r(S,x),L=O(new C(E).times(1e4-100*h.slip).div(1e4).toString(),n.decimals),N?y=await f(S,L,x,a,i):oe?y=await P(S,L,x,a,i):y=await $(S,L,x,a,i)}else{const S=O(n.amount,n.decimals).toString();U=await _(S,x),D=O(new C(U).times(1e4+100*h.slip).div(1e4).toString(),t.decimals),N?y=await K(S,D,x,a,i):oe?y=await g(S,D,x,a,i):y=await v(S,D,x,a,i)}e.btnLoading=!1,y.success&&F()};return ie(()=>w.query,a=>{a.inputCurrency&&(t.address=a.inputCurrency,F()),a.outputCurrency&&(n.address=a.outputCurrency,F())},{immediate:!0,deep:!0}),ie(()=>[t,n],async()=>{F()},{immediate:!0}),(a,i)=>(d(),p(X,null,[k(Ve,{class:"mt-4 lg:mt-0 lg:min-w-[600px]"},{default:H(()=>[o("div",$t,[k(ze,{onOpen:pe}),k(ue,{token:l(t),modelValue:l(t).amount,"onUpdate:modelValue":j,onFocus:fe,disabled:l(e).btnLoading,loading:l(e).aInputLoading},null,8,["token","modelValue","disabled","loading"]),o("div",{class:"py-5 flex-center"},[o("div",{onClick:xe,class:"cursor-pointer"},Lt)]),k(ue,{token:l(n),modelValue:l(n).amount,"onUpdate:modelValue":z,onFocus:ge,disabled:l(e).btnLoading,loading:l(e).bInputLoading},null,8,["token","modelValue","disabled","loading"]),l(e).havePair?(d(),R(wt,{key:0,tokenA:l(t),tokenB:l(n),swapDetail:l(m),isOut:l(me)},null,8,["tokenA","tokenB","swapDetail","isOut"])):Q("v-if",!0),l(b).account?(d(),R(de,{key:2,class:"mt-7",loading:l(e).btnLoading,disabled:l(ce),onClick:se},{default:H(()=>[l(e).havePair?+l(t).amount>+l(t).balance||l(t).balance<=0?(d(),p("span",Vt,u(a.$t("errorMsg.Insufficient Balance")),1)):l(te)?(d(),p("span",At,u(a.$t("trade.swap")),1)):(d(),p("span",Ot,"Approve")):(d(),p("span",Bt,u(a.$t("errorMsg.Insufficient liquidity")),1))]),_:1},8,["loading","disabled"])):(d(),R(de,{key:1,class:"mt-7",loading:l(e).btnLoading,disabled:!1,onClick:l(c)},{default:H(()=>[A(u(a.$t("common.connect")),1)]),_:1},8,["loading","onClick"]))])]),_:1}),k(Tt,{show:l(e).settingShow,onClose:i[0]||(i[0]=()=>l(e).settingShow=!1),timeValue:l(h).time,slipValue:l(h).slip,"onUpdate:slipValue":we,"onUpdate:timeValue":be},null,8,["show","timeValue","slipValue"])],64))}}),Ft=B(Pt,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/Swap.vue"]]),Ut={class:"lg:flex items-start justify-center relative"},Et=V({setup(s){const w=Le(),{t:b}=Be(),c=M(()=>[{id:0,name:b("trade.swap"),disabled:!1},{id:1,name:b("trade.liquidity"),disabled:!1,url:"/add"},{id:2,name:b("trade.perpetual"),disabled:!0},{id:3,name:b("trade.bridge"),disabled:!0}]),r=T({currentTab:0}),_=v=>{v.disabled||(r.currentTab=v.id,v.url&&w.push(v.url))};return(v,$)=>(d(),p("div",Ut,[k(Ee,{tabList:l(c),currentTab:l(r).currentTab,onChange:_,class:"lg:absolute lg:left-0"},null,8,["tabList","currentTab"]),k(Ft)]))}}),Mt=B(Et,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/Trade.vue"]]);export{Mt as default};
