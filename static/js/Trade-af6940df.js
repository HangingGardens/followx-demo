import{_ as L,d as B,o as r,c as p,F as X,g as ce,n as ve,t as u,b as o,m as T,i as Z,j as A,e as k,u as l,q as O,s as Q,v as ke,r as ye,x as H,w as M,y as le,p as Se,k as Ie,z as Ce,A as Te,B as ie,C as K,D as I,E as ue,G as C,H as $e,I as R,J as De,M as Le,K as Be,L as Oe}from"./index-ee66a127.js";import{C as Ae}from"./ColorsBorderBox-90d2d242.js";import{g as Ve,r as Pe,e as W,S as re}from"./SwapItem-6b503e2f.js";import{C as de}from"./ColorsButton-c0abe6e4.js";const Fe={class:"flex-center-bw lg:flex-col lg:gap-y-10 text-base rounded-xl border-2 border-solid border-[#1dede1] p-2.5"},Ue=["onClick"],Ee=B({props:{tabList:{type:Array,required:!0},currentTab:{type:Number,required:!0}},emits:["change"],setup(s,{emit:w}){return(b,c)=>(r(),p("div",Fe,[(r(!0),p(X,null,ce(s.tabList,d=>(r(),p("div",{key:d.id,class:ve(["cursor-pointer font-semibold rounded-lg py-1 px-2 lg:w-full text-center lg:min-w-[100px]",{"bg-[#1dede1]":d.id===s.currentTab,"text-origin":d.id===s.currentTab,"text-[#46598B]":d.disabled}]),onClick:f=>w("change",d)},u(d.name),11,Ue))),128))]))}}),Ne=L(Ee,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/components/TradeTab.vue"]]),qe=""+new URL("../images/exchange-3a08e937.svg",import.meta.url).href,Re=""+new URL("../images/setting-66f9da98.svg",import.meta.url).href,He={class:"flex-center-bw mb-[38px]"},Me=o("div",{class:"text-[32px] font-bold"},"Swap",-1),Ke=o("img",{src:Re,class:"w-7",alt:""},null,-1),je=[Ke],ze=B({emits:["open"],setup(s,{emit:w}){return(b,c)=>(r(),p("div",He,[Me,o("div",{onClick:c[0]||(c[0]=d=>w("open"))},je)]))}}),Ge=L(ze,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/swap/SwapHeader.vue"]]),Je={class:"border border-main border-solid rounded-lg p-2.5 px-3 mt-5"},We=A(" 1 "),Ze={class:"text-main"},Qe={class:"text-main"},Xe={key:0,class:"mt-1.5"},Ye={class:"flex-center-bw mt-1.5"},et={class:"text-main"},tt={class:"flex-center-bw mt-1.5"},at={class:"text-main"},nt={key:0},st={key:1},ot={class:"flex-center-bw mt-1.5"},lt={class:"text-main"},it={key:0},ut={else:""},rt={key:0},dt={key:1},ct={class:"flex-center-bw mt-1.5"},mt={class:"text-main"},pt=o("span",{class:"text-main"},null,-1),wt=B({props:{tokenA:{type:null,required:!0},tokenB:{type:null,required:!0},swapDetail:{type:null,required:!0},isOut:{type:Boolean,required:!1}},setup(s){const w=T({open:!1}),b=()=>{w.open=!w.open};return(c,d)=>{const f=Z("van-icon");return r(),p("div",Je,[o("div",{class:"flex-center-bw cursor-pointer",onClick:b},[o("div",null,[We,o("span",Ze,u(s.tokenA.symbol),1),A(" = "+u(s.swapDetail.aToBPrice)+" ",1),o("span",Qe,u(s.tokenB.symbol),1)]),k(f,{name:"arrow-down",alt:"",class:"w-2.5 h-auto text-main"})]),l(w).open?(r(),p("div",Xe,[o("div",Ye,[o("div",et,u(c.$t("trade.swapDetail.networkFee")),1),o("div",null," ~"+u(s.swapDetail.networkFee),1)]),o("div",tt,[o("div",at,u(c.$t("trade.swapDetail.priceImpact")),1),o("div",null,[s.swapDetail.priceImpact<.01?(r(),p("span",nt," <0.01% ")):(r(),p("span",st,"~"+u(l(O)(s.swapDetail.priceImpact,2))+"%",1))])]),o("div",ot,[o("div",lt,[s.isOut?(r(),p("span",it,u(c.$t("trade.swapDetail.minOutput")),1)):Q("v-if",!0),o("span",ut,u(c.$t("trade.swapDetail.maximumSold")),1)]),o("div",null,[s.isOut?(r(),p("span",rt,u(s.swapDetail.minimumOutput?s.swapDetail.minimumOutput.toFixed():"0")+" "+u(s.tokenB.symbol),1)):(r(),p("span",dt,u(s.swapDetail.maximumSold?s.swapDetail.maximumSold.toFixed():"0")+" "+u(s.tokenA.symbol),1))])]),o("div",ct,[o("div",mt,[A(u(c.$t("trade.swapDetail.expectOutput")),1),pt]),o("div",null,u(s.swapDetail.expectedOutput?s.swapDetail.expectedOutput.toFixed():"0")+" "+u(s.tokenB.symbol),1)])])):Q("v-if",!0)])}}}),bt=L(wt,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/swap/SwapDetail.vue"]]),ft=()=>{const s=Ve();return{getPair:async(b,c)=>{try{return await s.getPair(b,c)}catch(d){return ke(d)}}}};const Y=s=>(Se("data-v-27a4fc01"),s=s(),Ie(),s),gt={class:"bg-[#081e37] px-4 py-7 w-[320px]"},xt=Y(()=>o("div",null,"Max slippage",-1)),_t={class:"grid grid-cols-4 gap-x-2 mt-4 pb-6 text-main border-b border-solid border-main"},ht=["onClick"],vt={class:"flex-center"},kt=A(" % "),yt={class:"flex-center-bw gap-5 mt-4"},St=Y(()=>o("div",{class:"whitespace-nowrap"},"Transaction deadline",-1)),It={class:"flex-center text-main gap-1"},Ct=Y(()=>o("div",null,"min",-1)),Tt=B({props:{show:{type:Boolean,required:!0},slipValue:{type:[String,Number,null],required:!0},timeValue:{type:[String,Number,null],required:!0}},emits:["close","update:slip-value","update:time-value"],setup(s,{emit:w}){const{show:b,slipValue:c}=s,d=[.1,.5,1],f=ye(10),h=P=>{w("update:slip-value",P)},V=()=>{w("close"),w("update:time-value",f.value)};return(P,v)=>{const F=Z("VanField"),j=Z("VanPopup");return r(),H(j,{show:s.show,"onUpdate:show":v[2]||(v[2]=x=>le(b)?b.value=x:null),class:"bg-transparent",closeable:"",round:"",onClickOverlay:v[3]||(v[3]=x=>w("close")),onClickCloseIcon:V},{default:M(()=>[o("div",gt,[xt,o("div",_t,[(r(),p(X,null,ce(d,x=>o("div",{class:"cursor-pointer rounded-xl bg-[#061629] flex-center",onClick:ee=>h(String(x))},u(x)+" % ",9,ht)),64)),o("div",vt,[k(F,{modelValue:s.slipValue,"onUpdate:modelValue":[v[0]||(v[0]=x=>le(c)?c.value=x:null),h],class:"flex-1 bg-[#061629] rounded-xl text-xs text-baseColor font-bold",type:"number"},null,8,["modelValue"]),kt])]),o("div",yt,[St,o("div",It,[k(F,{modelValue:f.value,"onUpdate:modelValue":v[1]||(v[1]=x=>f.value=x),class:"flex-1 bg-[#061629] rounded-xl text-xs text-baseColor font-bold",type:"number","input-align":"center"},null,8,["modelValue"]),Ct])])])]),_:1},8,["show"])}}}),$t=L(Tt,[["__scopeId","data-v-27a4fc01"],["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/swap/SettingPop.vue"]]),Dt={class:"lg:px-8 px-2.5 py-5"},Lt=o("img",{src:qe,class:"w-[38px] h-[36px] mx-auto",alt:""},null,-1),Bt=[Lt],Ot={key:0},At={key:1},Vt={key:2},Pt={key:3},Ft=B({setup(s){const w=Ce(),{accountStore:b}=Te(),{connectWallet:c}=ie(),{getAmountsOut:d,getAmountsIn:f,swapTokensForExactTokens:h,swapExactTokensForTokens:V,swapExactETHForTokens:P,swapExactTokensForETH:v,swapETHForExactTokens:F,swapTokensForExactETH:j}=Pe(),{getPair:x}=ft(),ee=K(()=>!e.havePair||+t.amount<=0||+t.amount>+t.balance),te=K(()=>+t.allowance>=+t.amount&&t.allowance>0),t=T({...I.tokens[0],balance:0,allowance:0,decimals:18,amount:null}),n=T({...I.tokens[1],balance:0,allowance:0,decimals:18,amount:null}),m=T({networkFee:0,priceImpact:0,minimumOutput:null,maximumSold:null,expectedOutput:null,aToBPrice:0,bToAPrice:0}),me=K(()=>!e.aDisabled),e=T({settingShow:!1,btnLoading:!1,havePair:!1,aDisabled:!1,bDisabled:!1,aInputLoading:!1,bInputLoading:!1,pair:null,txInfo:{tx:null,text:""}}),_=T({slip:.1,time:10,min:"0"}),pe=async()=>{e.settingShow=!e.settingShow},we=a=>{_.slip=a,!(!t.amount&&!n.amount)&&(z(t.amount),G(n.account))},be=a=>{_.time=a},fe=()=>{e.bDisabled=!0,e.aDisabled=!1},ge=()=>{e.aDisabled=!0,e.bDisabled=!1},z=async a=>{if(e.btnLoading||e.aDisabled)return e.bInputLoading=!1;if(a===""){t.amount=null,n.amount=null,m.expectedOutput=null,m.minimumOutput=null,m.maximumSold=null,m.priceImpact=null,e.bInputLoading=!1;return}t.amount=a,e.bInputLoading=!0;const i=await d(a,[t.address,n.address]);n.amount=i||"0",m.expectedOutput=new C(n.amount),m.minimumOutput=new C(n.amount).times(1e4-100*_.slip).div(1e4),m.maximumSold=new C(t.amount).times(1e4+100*_.slip).div(1e4),m.priceImpact=a/+await W(t.address).balanceOf(e.pair)*100,e.bInputLoading=!1},G=async a=>{if(e.btnLoading||e.bDisabled)return e.aInputLoading=!1;if(a===""){t.amount=null,n.amount=null,m.expectedOutput=null,m.minimumOutput=null,m.maximumSold=null,m.priceImpact=null,e.aInputLoading=!1;return}n.amount=a,e.aInputLoading=!0,t.amount=await f(a,[t.address,n.address])||0,m.expectedOutput=new C(n.amount),m.minimumOutput=new C(n.amount).times(1e4-100*_.slip).div(1e4),m.maximumSold=new C(t.amount).times(1e4+100*_.slip).div(1e4),e.aInputLoading=!1},xe=async()=>{var i;if(e.btnLoading)return;let a=T({...t,amount:(i=t.amount)==null?void 0:i.toString()});if(t.address=n.address,n.address=a.address,t.icon=n.icon,n.icon=a.icon,await ae(),e.bDisabled?(e.aInputLoading=!0,n.amount=t.amount):(e.bInputLoading=!0,t.amount=n.amount),await ne(),!t.amount&&!n.amount){e.aInputLoading=!1,e.bInputLoading=!1;return}e.bDisabled?(e.aDisabled=!0,e.bDisabled=!1,n.amount=t.amount,G(n.amount)):(e.aDisabled=!1,e.bDisabled=!0,t.amount=n.amount,z(t.amount))},J=async a=>{const{balanceOf:i,allowance:g,symbol:y,decimals:E}=W(a),$=R(a,I.BNB)?await De():await i(),N=R(a,I.BNB)?Le:await g(I.PANCAKE_ROUTER),D=await y(),q=await E();return{balance:$,allowance:+N,symbol:D,decimals:q}},_e=async()=>{const a=await x(t.address,n.address);return e.pair=a,a!==$e},ae=async()=>{const a=await J(t.address),i=await J(n.address);t.balance=a.balance,t.allowance=a.allowance,t.symbol=a.symbol,t.decimals=a.decimals,n.balance=i.balance,n.allowance=i.allowance,n.symbol=i.symbol,n.decimals=i.decimals},ne=async()=>{if(!e.havePair)return;const a=[t.address,n.address],i=await d(1,a);m.aToBPrice=i||0;const g=await f(1,a.reverse());m.bToAPrice=g||0},U=async()=>{e.btnLoading=!0,ae(),e.havePair=await _e(),ne(),e.btnLoading=!1},se=async()=>{if(!te.value){e.btnLoading=!0;const a=await W(t.address).approve(I.PANCAKE_ROUTER);if(!a.success)return e.btnLoading=!1;if(a.success){const i=await J(t.address);t.allowance=i.allowance,se()}return}he()},he=async()=>{e.btnLoading=!0;const a=ie().getCurrentAccount(),i=_.time,g=[t.address,n.address];let y=null,E=0,$=null,N=0,D=null;const q=R(t.address,I.BNB),oe=R(n.address,I.BNB);if(e.bDisabled){const S=O(t.amount,t.decimals).toString();N=await d(S,g),D=O(new C(N).times(1e4-100*_.slip).div(1e4).toString(),n.decimals),q?y=await P(S,D,g,a,i):oe?y=await v(S,D,g,a,i):y=await V(S,D,g,a,i)}else{const S=O(n.amount,n.decimals).toString();E=await f(S,g),$=O(new C(E).times(1e4+100*_.slip).div(1e4).toString(),t.decimals),q?y=await F(S,$,g,a,i):oe?y=await j(S,$,g,a,i):y=await h(S,$,g,a,i)}e.btnLoading=!1,y.success&&U()};return ue(()=>w.query,a=>{a.inputCurrency&&(t.address=a.inputCurrency,U()),a.outputCurrency&&(n.address=a.outputCurrency,U())},{immediate:!0,deep:!0}),ue(()=>[t,n],async()=>{U()},{immediate:!0}),(a,i)=>(r(),p(X,null,[k(Ae,{class:"mt-4 lg:mt-0 lg:min-w-[600px]"},{default:M(()=>[o("div",Dt,[k(Ge,{onOpen:pe}),k(re,{token:l(t),modelValue:l(t).amount,"onUpdate:modelValue":z,onFocus:fe,disabled:l(e).btnLoading,loading:l(e).aInputLoading},null,8,["token","modelValue","disabled","loading"]),o("div",{class:"py-5 flex-center"},[o("div",{onClick:xe,class:"cursor-pointer"},Bt)]),k(re,{token:l(n),modelValue:l(n).amount,"onUpdate:modelValue":G,onFocus:ge,disabled:l(e).btnLoading,loading:l(e).bInputLoading},null,8,["token","modelValue","disabled","loading"]),l(e).havePair?(r(),H(bt,{key:0,tokenA:l(t),tokenB:l(n),swapDetail:l(m),isOut:l(me)},null,8,["tokenA","tokenB","swapDetail","isOut"])):Q("v-if",!0),l(b).account?(r(),H(de,{key:2,class:"mt-7",loading:l(e).btnLoading,disabled:l(ee),onClick:se},{default:M(()=>[l(e).havePair?+l(t).amount>+l(t).balance||l(t).balance<=0?(r(),p("span",At,u(a.$t("errorMsg.Insufficient Balance")),1)):l(te)?(r(),p("span",Pt,u(a.$t("trade.swap")),1)):(r(),p("span",Vt,"Approve")):(r(),p("span",Ot,u(a.$t("errorMsg.Insufficient liquidity")),1))]),_:1},8,["loading","disabled"])):(r(),H(de,{key:1,class:"mt-7",loading:l(e).btnLoading,disabled:!1,onClick:l(c)},{default:M(()=>[A(u(a.$t("common.connect")),1)]),_:1},8,["loading","onClick"]))])]),_:1}),k($t,{show:l(e).settingShow,onClose:i[0]||(i[0]=()=>l(e).settingShow=!1),timeValue:l(_).time,slipValue:l(_).slip,"onUpdate:slipValue":we,"onUpdate:timeValue":be},null,8,["show","timeValue","slipValue"])],64))}}),Ut=L(Ft,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/Swap.vue"]]),Et={class:"lg:flex items-start justify-center relative"},Nt=B({setup(s){const w=Be(),{t:b}=Oe(),c=K(()=>[{id:0,name:b("trade.swap"),disabled:!1},{id:1,name:b("trade.liquidity"),disabled:!1,url:"/add"},{id:2,name:b("trade.perpetual"),disabled:!0},{id:3,name:b("trade.bridge"),disabled:!0}]),d=T({currentTab:0}),f=h=>{h.disabled||(d.currentTab=h.id,h.url&&w.push(h.url))};return(h,V)=>(r(),p("div",Et,[k(Ne,{tabList:l(c),currentTab:l(d).currentTab,onChange:f,class:"lg:absolute lg:left-0"},null,8,["tabList","currentTab"]),k(Ut)]))}}),Kt=L(Nt,[["__file","/Users/wangkeai/work/xueyan/followx/followx-dapp/src/view/trade/Trade.vue"]]);export{Kt as default};
